<div class="container">
  <h2 class="pt-2 pb-2 mt-5 border-bottom">{{ "pages.simulator.title" | translate }}</h2>
  <div class="row mt-2 gy-4">
    <div class="col-xl-6">
      <div class="card">
        <h5 class="card-header d-flex flex-wrap justify-content-start">
          <span class="me-auto">{{ "pages.simulator.graphConfiguration" | translate}} #1</span>
          <div class="text-end">
            <i *ngIf="!graphProgress && topology !== null && graphSettings !== null" class="bi bi-check-lg text-success"></i>
            <i *ngIf="!graphProgress && topology === null && graphSettings === null" class="bi bi-x-lg text-danger"></i>
            <div *ngIf="graphProgress" class="spinner-border spinner-border-sm" style="margin-bottom: 1px;" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </h5>
        <div class="card-body">
          <form id="graph-form" novalidate>
            <div class="my-3">
              <label for="topologySelect" class="form-label">{{ "pages.simulator.topology" | translate }}</label>
              <div class="input-group">
                <select id="topologySelect" class="form-select" required>
                  <option selected disabled value="">{{"pages.simulator.choose" | translate}}...</option>
                  <option *ngFor="let type of graphTypes" value="{{type}}">{{ "graph.type." + type | translate}}</option>
                </select>
                <label id="graph-info" class="input-group-text graph-info-disabled" for="topologySelect" data-bs-toggle="tooltip" data-bs-placement="bottom">
                  <i class="bi bi-info-circle"></i>
                </label>
                <div class="invalid-feedback">
                  {{ "pages.simulator.invalidGraphType" | translate}}
                </div>
              </div>
            </div>
            <div class="my-4">
              <label for="propertiesAccordion" class="form-label">{{"pages.simulator.properties" | translate}}</label>
              <div class="accordion accordion-disabled" id="propertiesAccordion">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="headingThree">
                    <button disabled style="height: 38px;" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseForm" aria-expanded="false" aria-controls="collapseForm">
                      <div *ngIf="topology === null">{{"pages.simulator.topologyFirst" | translate}}</div>
                      <div *ngIf="topology !== null">{{ "graph.type." + topology | translate }}</div>
                    </button>
                  </h2>
                  <div id="collapseForm" class="accordion-collapse collapse" data-bs-parent="#propertiesAccordion">
                    <div class="accordion-body">
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="defaultSettings" checked (click)="switchFormStrategy()">
                        <label class="form-check-label" for="defaultSettings">{{ "pages.simulator.defaultSettings" | translate}}</label>
                      </div>
                      <div [ngSwitch]="topology">
                        <div *ngSwitchCase="graphTypes[0]">
                          <div class="row mt-2 gy-3">
                            <div class="col-xl-6">
                              <label for="tree" class="form-label">Trees</label>
                              <input type="number" min="1" required class="form-control" id="tree">
                            </div>
                            <div class="col-xl-6">
                              <label for="node" class="form-label">Final nodes</label>
                              <input type="number" min="1" required class="form-control" id="node">
                            </div>
                          </div>
                        </div>
                        <div *ngSwitchCase="graphTypes[1]">
                          <div class="row mt-2 gy-3">
                            <div class="col-xl-6">
                              <label for="init" class="form-label">Inital nodes</label>
                              <input type="number" min="1" required class="form-control" id="init">
                            </div>
                            <div class="col-xl-6">
                              <label for="edge" class="form-label">Edge growth</label>
                              <input type="number" min="1" required class="form-control" id="edge">
                            </div>
                            <div class="col-xl-6">
                              <label for="node" class="form-label">Final nodes</label>
                              <input type="number" min="1" required class="form-control" id="node">
                            </div>
                          </div>
                        </div>
                        <div *ngSwitchCase="graphTypes[2]">
                          <div class="row mt-2 gy-3">
                            <div class="col-xl-6">
                              <label for="node" class="form-label">Nodes</label>
                              <input type="number" min="1" required class="form-control" id="node">
                            </div>
                          </div>
                        </div>
                        <div *ngSwitchCase="graphTypes[3]">
                          <div class="row mt-2 gy-3">
                            <div class="col-xl-6">
                              <label for="node" class="form-label">Nodes</label>
                              <input type="number" min="1" required class="form-control" id="node">
                            </div>
                          </div>
                        </div>
                        <div *ngSwitchCase="graphTypes[4]">
                          <div class="row mt-2 gy-3">
                            <div class="col-xl-6">
                              <label for="node" class="form-label">Nodes</label>
                              <input type="number" min="1" required class="form-control" id="node">
                            </div>
                            <div class="col-xl-6">
                              <label for="edge" class="form-label">Edges</label>
                              <input type="number" min="1" required class="form-control" id="edge">
                            </div>
                          </div>
                        </div>
                        <div *ngSwitchCase="graphTypes[5]">
                          <div class="row mt-2 gy-3">
                            <div class="col-xl-6">
                              <label for="node" class="form-label">Nodes</label>
                              <input type="number" min="1" required class="form-control" id="node">
                            </div>
                            <div class="col-xl-6">
                              <label for="propability" class="form-label">Edge propability (<span id="propability-text">50</span>%)</label>
                              <input type="range" required min="0" (input)="setEdgePropabilityText()" max="1" step="0.01" class="form-range" id="propability">
                            </div>
                          </div>
                        </div>
                        <div *ngSwitchCase="graphTypes[6]">
                          <div class="row mt-2 gy-3">
                            <div class="col-xl-6">
                              <label for="row" class="form-label">Rows</label>
                              <input type="number" min="2" required class="form-control" id="row">
                            </div>
                            <div class="col-xl-6">
                              <label for="column" class="form-label">Columns</label>
                              <input type="number" min="2" required class="form-control" id="column">
                            </div>
                          </div>
                        </div>
                        <div *ngSwitchCase="graphTypes[7]">
                          <div class="row mt-2 gy-3">
                            <div class="col-xl-6">
                              <label for="dimension" class="form-label">Dimension</label>
                              <input type="number" min="1" required class="form-control" id="dimension">
                            </div>
                          </div>
                        </div>
                        <div *ngSwitchCase="graphTypes[8]">
                          <div class="row mt-2 gy-3">
                            <div class="col-xl-6">
                              <label for="size" class="form-label">Size</label>
                              <input type="number" min="1" required class="form-control" id="size">
                            </div>
                          </div>
                        </div>
                        <div *ngSwitchCase="graphTypes[9]">
                          <div class="row mt-2 gy-3">
                            <div class="col-xl-6">
                              <label for="size" class="form-label">Size</label>
                              <input type="number" min="1" required class="form-control" id="size">
                            </div>
                          </div>
                        </div>
                        <div *ngSwitchCase="graphTypes[10]">
                          <div class="row mt-2 gy-3">
                            <div class="col-xl-6">
                              <label for="size" class="form-label">Size</label>
                              <input type="number" min="1" required class="form-control" id="size">
                            </div>
                          </div>
                        </div>
                        <div *ngSwitchCase="graphTypes[11]">
                          <div class="row mt-2 gy-3">
                            <div class="col-xl-6">
                              <label for="node" class="form-label">Node</label>
                              <input type="number" min="1" required class="form-control" id="node">
                            </div>
                            <div class="col-xl-6">
                              <label for="degree" class="form-label">Degree</label>
                              <input type="number" min="1" required class="form-control" id="degree">
                            </div>
                          </div>
                        </div>
                        <div *ngSwitchCase="graphTypes[12]">
                          <div class="row mt-2 gy-3">
                            <div class="col-xl-6">
                              <label for="order" class="form-label">Order</label>
                              <input type="number" min="1" required class="form-control" id="order">
                            </div>
                          </div>
                        </div>
                        <div *ngSwitchCase="graphTypes[13]">
                          <div class="row mt-2 gy-3">
                            <div class="col-xl-6">
                              <label for="size" class="form-label">Size</label>
                              <input type="number" min="1" required class="form-control" id="size">
                            </div>
                          </div>
                        </div>
                        <div *ngSwitchCase="graphTypes[14]">
                          <div class="row mt-2 gy-3">
                            <div class="col-xl-6">
                              <select class="form-select" required id="mode">
                                <option value="WINDMILL">{{"Windmill"}}</option>
                                <option value="DUTCHWINDMILL">{{"Dutch Windmill"}}</option>
                              </select>
                            </div>
                            <div class="col-xl-6">
                              <label for="copies" class="form-label">Copies</label>
                              <input type="number" min="1" required class="form-control" id="copies">
                            </div>
                            <div class="col-xl-6">
                              <label for="size" class="form-label">Size</label>
                              <input type="number" min="1" required class="form-control" id="size">
                          </div>
                        </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <button class="btn btn-outline-primary my-3 me-3" (click)="configureGraph()">{{'pages.simulator.configure' | translate }}</button>
            <button *ngIf="graphConfigured" class="btn btn-outline-primary my-3" (click)="resetGraph()">{{'pages.simulator.reset' | translate }}</button>
          </form>
        </div>
      </div>
    </div>
    <div class="col-xl-6">
      <div class="card">
        <h5 class="card-header d-flex flex-wrap justify-content-start">
          <span class="me-auto">{{ "pages.simulator.algorithmConfiguration" | translate}} #2</span>
          <div class="text-end">
            <i class="bi bi-x-lg text-danger"></i>
          </div>
        </h5>
        <div class="card-body">
          Text...
        </div>
      </div>
    </div>
  </div>
  <div class="row mt-4 justify-content-center">
    <div class="col-xl-6">
      <div class="card text-center">
        <div class="card-img-top card-header">
          <div id="preview-actions">
            <i (click)="initPreviewGraph()" type="button" data-bs-toggle="modal" data-bs-target="#previewModal" class="btn bi bi-arrows-angle-expand custom-icon"></i>
          </div>
          <!-- Preview Modal -->
          <div class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" id="previewModal" tabindex="-1">
            <div class="modal-dialog modal-xl modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h1 class="modal-title fs-5">{{ "pages.simulator.simulationPreview" | translate}}</h1>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div id="preview-dialog" class="modal-body">
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>
          <div id="preview-container"></div>
        </div>
        <div class="card-body">
          <h5 class="card-title">{{ "pages.simulator.simulationPreview" | translate}}</h5>
          <p class="card-text text-muted fw-light">{{ "pages.simulator.previewDesc" | translate}}</p>
          <button class="btn btn-outline-primary btn-lg">
            {{ "pages.simulator.launch" | translate }}
            <i class="bi bi-rocket-takeoff"></i>
          </button>
        </div>
        <div class="card-footer text-muted">
          <small>Not configured yet</small>
        </div>
      </div>
    </div>
  </div>
</div>

<!--
TITLE
<div class="pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">{{ "pages.simulator.title" | translate }}</h1>
</div>

OPERATORS SECTION

<div class="row mt-4">
  <div class="col-6">
    <button
      mat-mini-fab
      class="simulation-operators"
      (click)="playSimulator()"
      [disabled]="!graphConfiguration || !algorithmConfiguration"
    >
      <mat-icon svgIcon="play"></mat-icon>
    </button>
    <button
      mat-mini-fab
      class="simulation-operators"
      (click)="stopSimulator()"
      [disabled]="!graphConfiguration || !algorithmConfiguration"
    >
      <mat-icon svgIcon="pause"></mat-icon>
    </button>
    <button
      mat-mini-fab
      class="simulation-operators"
      (click)="stepSimulator()"
      [disabled]="!graphConfiguration || !algorithmConfiguration"
    >
      <mat-icon svgIcon="next-step"></mat-icon>
    </button>
    <mat-icon svgIcon="speed" id="speed-icon"></mat-icon>
    <mat-slider
      color="primary"
      [max]="2000"
      [min]="200"
      [step]="50"
      [thumbLabel]="true"
      [(ngModel)]="speed"
      [disabled]="!graphConfiguration || !algorithmConfiguration"
    ></mat-slider>
    <span class="server-response-time">{{ speed }} ms</span>
  </div>
  <div class="col-6 text-end">
    <span class="server-response-time"
      >{{ "simulationComponent_steps" | translate }}: {{ getSteps() }}</span
    >
    <span class="server-response-time"
      >{{ "simulationComponent_serverResponseTime" | translate }}:
      {{ RTT }} ms</span
    >
    <button
      mat-mini-fab
      class="simulation-operators"
      (click)="resetSimulator()"
      [disabled]="!graphConfiguration || !algorithmConfiguration"
    >
      <mat-icon svgIcon="reset"></mat-icon>
    </button>
    <button
      mat-mini-fab
      class="simulation-operators"
      (click)="save()"
      [disabled]="isSaveDisabled()"
    >
      <mat-icon svgIcon="save"></mat-icon>
    </button>
    <button
      mat-mini-fab
      class="simulation-operators"
      (click)="openAlgorithmConfiguration()"
      [disabled]="!graphConfiguration || !!algorithmConfiguration"
    >
      <mat-icon svgIcon="robot"></mat-icon>
    </button>
    <button
      mat-mini-fab
      class="simulation-operators"
      (click)="openGraphConfiguration()"
      [disabled]="!!graphConfiguration"
    >
      <mat-icon svgIcon="tree"></mat-icon>
    </button>
  </div>
</div>

SIMULATOR SECTION

<div class="row mt-4">
  <div class="col-12">
    <mat-card id="vis-container"></mat-card>
  </div>
</div>

INFORMATION PANEL SECTION

<div class="row mt-4">
  <div class="col-12">
    <div class="mat-elevation-z8 robot-table" *ngIf="algorithmConfiguration">
      <table mat-table [dataSource]="getRobots()">
        <ng-container matColumnDef="ID">
          <th mat-header-cell *matHeaderCellDef>
            {{ "simulationComponent_tableIDColumn" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.id }}</td>
        </ng-container>

        <ng-container matColumnDef="onID">
          <th mat-header-cell *matHeaderCellDef>
            {{ "simulationComponent_tablePositionColumn" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.onID }}</td>
        </ng-container>

        <ng-container matColumnDef="label">
          <th mat-header-cell *matHeaderCellDef>{{ "simulationComponent_tableLabelColumn" | translate }}</th>
          <td mat-cell *matCellDef="let element">
            {{ element.treeLabel }}
          </td>
        </ng-container>

        <ng-container matColumnDef="state">
          <th mat-header-cell *matHeaderCellDef>
            {{ "simulationComponent_tableStateColumn" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">
            <span
              [ngStyle]="{ color: '#2EDA33' }"
              *ngIf="element.state === 'START'"
              >{{ element.state | translate }}</span
            >
            <span
              [ngStyle]="{ color: '#EB6813' }"
              *ngIf="element.state === 'EXPLORE'"
              >{{ element.state | translate }}</span
            >
            <span
              [ngStyle]="{ color: '#133BDE' }"
              *ngIf="element.state === 'LEADER'"
              >{{ element.state | translate }}</span
            >
            <span
              [ngStyle]="{ color: '#EF4019' }"
              *ngIf="element.state === 'SETTLED'"
              >{{ element.state | translate }}</span
            >
            <span
              [ngStyle]="{ color: '#050303' }"
              *ngIf="element.state === 'TERMINATED'"
              >{{ element.state | translate }}</span
            >
            <span
              [ngStyle]="{ color: '#BF40BF' }"
              *ngIf="element.state === 'CRASHED'"
              >{{ element.state | translate }}</span
            >
          </td>
        </ng-container>

        <ng-container matColumnDef="stateIcon">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let element">
            <mat-icon
              svgIcon="robot"
              *ngIf="element.state === 'START'"
            ></mat-icon>
            <mat-icon
              svgIcon="search"
              *ngIf="element.state === 'EXPLORE'"
            ></mat-icon>
            <mat-icon
              svgIcon="star"
              *ngIf="element.state === 'LEADER'"
            ></mat-icon>
            <mat-icon
              svgIcon="check"
              *ngIf="element.state === 'SETTLED'"
            ></mat-icon>
            <mat-icon
              svgIcon="pause"
              *ngIf="element.state === 'TERMINATED'"
            ></mat-icon>
            <mat-icon
              svgIcon="crashed"
              *ngIf="element.state === 'CRASHED'"
            ></mat-icon>
          </td>
        </ng-container>

        <ng-container matColumnDef="crash">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let element">
            <button mat-raised-button color="primary" (click)="crashRobot(element)">Crash</button>
          </td>
        </ng-container>

        <tr
          mat-header-row
          *matHeaderRowDef="algorithmConfiguration.algorithmType == 'FAULTY_DFS_DISPERSION' ? faultyDisplayedColumns : displayedColumns; sticky: true"
        ></tr>
        <tr mat-row *matRowDef="let row; columns: algorithmConfiguration.algorithmType == 'FAULTY_DFS_DISPERSION' ? faultyDisplayedColumns : displayedColumns"></tr>
      </table>
    </div>
  </div>
</div>
-->